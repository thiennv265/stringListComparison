<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>So s√°nh t·ª´ t√¨m ki·∫øm</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>
<body>

<script>
  document.body.innerHTML = `
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: #f7f9fc;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 100%;
        padding: 30px;
      }

      h2 {
        margin-bottom: 20px;
        color: #333;
      }

      textarea, input[type="number"], select {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 12px;
        margin-top: 5px;
        resize: both;
      }

      button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        margin-right: 10px;
      }

      #startBtn {
        background: #007bff;
        color: white;
      }

      #startBtn:hover {
        background: #0056b3;
      }

      #downloadBtn {
        background: #28a745;
        color: white;
      }

      #downloadBtn:hover {
        background: #1e7e34;
      }

      table {
        border-collapse: collapse;
        font-size: 10px;
      }

      table th, table td {
        border: 1px solid #ccc;
        padding: 6px 10px;
        text-align: left;
      }

      table th {
        background: #f1f1f1;
      }

      .tables-wrapper {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-between;
        gap: 0;
      }

      .table-box {
        flex: 1;
        margin: 0;
        min-width: 350px;
      }

      #progress {
        margin-top: 10px;
        font-weight: bold;
      }
    </style>

    <div class="container">
      <h2>üîç SO S√ÅNH CHU·ªñI</h2>

      <label>üì• <strong>Input List (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y):</strong></label>
      <textarea id="inputList" rows="5">Nguy·ªÖn VƒÉn,Thi√™n Nhi√™n</textarea><br><br>

      <label>üìã <strong>Checker List (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y):</strong></label>
      <textarea id="checkerList" rows="5">Nguy·ªÖn VƒÉn Thi√™n,Thi√™n Nhi√™n Nguy·ªÖn</textarea><br><br>

      <label>üîß <strong>Ch·ªçn ki·ªÉu t√¨m ki·∫øm:</strong></label>
      <select id="matchMode">
        <option value="percent">T√¨m theo % kh·ªõp</option>
        <option value="exact">T√¨m theo c·ª•m t·ª´ ch√≠nh x√°c</option>
      </select><br><br>

      <label>üéØ <strong>% kh·ªõp t·ªëi thi·ªÉu (ch·ªâ √°p d·ª•ng n·∫øu ch·ªçn theo %):</strong></label>
      <input id="minMatch" type="number" value="80" min="0" max="100"><br><br>

      <button id="startBtn" onclick="startMatching()">‚ñ∂Ô∏è Start</button>
      <button id="downloadBtn" onclick="downloadCSV()" style="display:none;">‚¨áÔ∏è T·∫£i CSV</button>

      <p id="progress"></p>
      <div id="results"></div>
    </div>
  `;

  let lastResults = [];

  window.startMatching = async function () {
    const inputListRaw = document.getElementById("inputList").value.split(",").map(s => s.trim()).filter(Boolean);
    const checkerListRaw = document.getElementById("checkerList").value.split(",").map(s => s.trim()).filter(Boolean);
    const minMatch = parseInt(document.getElementById("minMatch").value);
    const mode = document.getElementById("matchMode").value;

    const progressEl = document.getElementById("progress");
    const resultsEl = document.getElementById("results");
    const downloadBtn = document.getElementById("downloadBtn");

    const inputList = inputListRaw.map(s => s.toLowerCase());
    const checkerList = checkerListRaw.map(s => s.toLowerCase());

    const total = inputList.length;
    const results = [];
    const summaryRows = [];

    resultsEl.innerHTML = "";
    downloadBtn.style.display = "none";

    function splitWords(str) {
      return str.split(/\s+/);
    }

    function matchPercent(searchWords, checkerWords) {
      const matched = searchWords.filter(word => checkerWords.includes(word));
      return (matched.length / searchWords.length) * 100;
    }

    for (let i = 0; i < inputList.length; i++) {
      const inputItem = inputList[i];
      const inputRaw = inputListRaw[i];
      const searchWords = splitWords(inputItem);
      let matchCount = 0;

      for (let j = 0; j < checkerList.length; j++) {
        const checkerItem = checkerList[j];
        const checkerRaw = checkerListRaw[j];
        const checkerWords = splitWords(checkerItem);
        let matched = false;
        let percent = 0;

        if (mode === "percent") {
          percent = matchPercent(searchWords, checkerWords);
          matched = percent >= minMatch;
        } else if (mode === "exact") {
          matched = checkerItem.includes(inputItem);
          percent = matched ? 100 : 0;
        }

        if (matched) {
          results.push({
            "Chu·ªói g·ªëc": inputRaw,
            "Chu·ªói d√πng t√¨m ki·∫øm": inputItem,
            "Chu·ªói t√¨m ƒë∆∞·ª£c": checkerItem,
            "Chu·ªëi g·ªëc t√¨m ƒë∆∞·ª£c": checkerRaw,
            "% kh·ªõp nhau": percent.toFixed(2)
          });
          matchCount++;
        }
      }

      summaryRows.push({
        "STT": `${i + 1} / ${total}`,
        "Chu·ªói d√πng t√¨m ki·∫øm": inputRaw,
        "S·ªë k·∫øt qu·∫£ kh·ªõp": matchCount
      });

      progressEl.textContent = `(${i + 1}/${total}) ƒêang t√¨m: "${inputRaw}" ‚Üí ${matchCount} k·∫øt qu·∫£ kh·ªõp`;
      if (i === inputList.length - 1) {
        progressEl.textContent = `‚úÖ ƒê√£ xong: ${total}/${total} chu·ªói ƒë√£ x·ª≠ l√Ω.`;
      }

      await new Promise(r => setTimeout(r, 50));
    }

    if (results.length === 0) {
      resultsEl.innerHTML = `<p style="color: red; font-weight: bold;">‚ùå Kh√¥ng c√≥ k·∫øt qu·∫£ n√†o kh·ªõp.</p>`;
      return;
    }

    let summaryTable = "<table><tr><th>STT</th><th>Chu·ªói t√¨m ki·∫øm</th><th>S·ªë k·∫øt qu·∫£ kh·ªõp</th></tr>";
    for (const row of summaryRows) {
      summaryTable += `<tr><td>${row["STT"]}</td><td>${row["Chu·ªói d√πng t√¨m ki·∫øm"]}</td><td>${row["S·ªë k·∫øt qu·∫£ kh·ªõp"]}</td></tr>`;
    }
    summaryTable += "</table>";

    let resultTable = "<table><tr><th>Chu·ªói g·ªëc</th><th>Chu·ªói d√πng t√¨m ki·∫øm</th><th>Chu·ªói t√¨m ƒë∆∞·ª£c</th><th>Chu·ªëi g·ªëc t√¨m ƒë∆∞·ª£c</th><th>% kh·ªõp nhau</th></tr>";
    for (const row of results) {
      resultTable += `<tr><td>${row["Chu·ªói g·ªëc"]}</td><td>${row["Chu·ªói d√πng t√¨m ki·∫øm"]}</td><td>${row["Chu·ªói t√¨m ƒë∆∞·ª£c"]}</td><td>${row["Chu·ªëi g·ªëc t√¨m ƒë∆∞·ª£c"]}</td><td>${row["% kh·ªõp nhau"]}</td></tr>`;
    }
    resultTable += "</table>";

    resultsEl.innerHTML = `
      <div class="tables-wrapper">
        <div class="table-box">${summaryTable}</div>
        <div class="table-box">${resultTable}</div>
      </div>
    `;

    lastResults = results;
    downloadBtn.style.display = "inline-block";
  };

  window.downloadCSV = function () {
    if (lastResults.length === 0) {
      alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i.");
      return;
    }

    const headers = ["Chu·ªói g·ªëc", "Chu·ªói d√πng t√¨m ki·∫øm", "Chu·ªói t√¨m ƒë∆∞·ª£c", "Chu·ªëi g·ªëc t√¨m ƒë∆∞·ª£c", "% kh·ªõp nhau"];
    const csvRows = [
      headers,
      ...lastResults.map(r => headers.map(field => `"${r[field].replace(/"/g, '""')}"`))
    ];

    const csvContent = csvRows.map(row => row.join(",")).join("\n");

    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "ket_qua_day_du.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };
</script>

</body>
</html>
